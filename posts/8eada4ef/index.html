<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>XJTU-ICS Lab 2: Bomb Lab | 日拱一卒</title><meta name="author" content="Derrick Liu,1209830516abc@gmail.com"><meta name="copyright" content="Derrick Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言Bomb Lab是课程的第二个实验，它给出了一个“炸弹”文件，要求学习者从可执行文件反汇编得到汇编代码，然后通过GDB（GNU Debugger）来知晓“炸弹”的引爆逻辑，并由此给出正确的解决文件solution.txt，正确地拆除全部phase的炸弹。如果成功独立完成了这个实验，相信你对GDB的使用和x86-64汇编语言的理解会上一个台阶。 实验文档与代码框架实验文档请点击此链接查看。每个人">
<meta property="og:type" content="article">
<meta property="og:title" content="XJTU-ICS Lab 2: Bomb Lab">
<meta property="og:url" content="https://ziyuliu258.github.io/posts/8eada4ef/index.html">
<meta property="og:site_name" content="日拱一卒">
<meta property="og:description" content="前言Bomb Lab是课程的第二个实验，它给出了一个“炸弹”文件，要求学习者从可执行文件反汇编得到汇编代码，然后通过GDB（GNU Debugger）来知晓“炸弹”的引爆逻辑，并由此给出正确的解决文件solution.txt，正确地拆除全部phase的炸弹。如果成功独立完成了这个实验，相信你对GDB的使用和x86-64汇编语言的理解会上一个台阶。 实验文档与代码框架实验文档请点击此链接查看。每个人">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ziyuliu258.github.io/images/avatar.jpg">
<meta property="article:published_time" content="2026-02-18T08:54:45.000Z">
<meta property="article:modified_time" content="2026-02-19T03:43:27.661Z">
<meta property="article:author" content="Derrick Liu">
<meta property="article:tag" content="ICS实验">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ziyuliu258.github.io/images/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "XJTU-ICS Lab 2: Bomb Lab",
  "url": "https://ziyuliu258.github.io/posts/8eada4ef/",
  "image": "https://ziyuliu258.github.io/images/avatar.jpg",
  "datePublished": "2026-02-18T08:54:45.000Z",
  "dateModified": "2026-02-19T03:43:27.661Z",
  "author": [
    {
      "@type": "Person",
      "name": "Derrick Liu",
      "url": "https://ziyuliu258.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/avatar.jpg"><link rel="canonical" href="https://ziyuliu258.github.io/posts/8eada4ef/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'XJTU-ICS Lab 2: Bomb Lab',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/images/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-handshake"></i><span> Friends</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/images/bg2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">XJTU-ICS Lab 2: Bomb Lab</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-handshake"></i><span> Friends</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">XJTU-ICS Lab 2: Bomb Lab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-18T08:54:45.000Z" title="发表于 2026-02-18 16:54:45">2026-02-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-19T03:43:27.661Z" title="更新于 2026-02-19 11:43:27">2026-02-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>Bomb Lab</code>是课程的第二个实验，它给出了一个“炸弹”文件，要求学习者从可执行文件反汇编得到汇编代码，然后通过<code>GDB（GNU Debugger）</code>来知晓“炸弹”的引爆逻辑，并由此给出正确的解决文件<code>solution.txt</code>，正确地拆除全部phase的炸弹。如果成功独立完成了这个实验，相信你对<code>GDB</code>的使用和<code>x86-64</code>汇编语言的理解会上一个台阶。</p>
<h3 id="实验文档与代码框架"><a href="#实验文档与代码框架" class="headerlink" title="实验文档与代码框架"></a>实验文档与代码框架</h3><p>实验文档请点击<a target="_blank" rel="noopener" href="https://xjtu-ics.github.io/labs/lab2">此链接</a>查看。每个人的<code>bomb</code>文件对应的正确答案是不一样的，所以似乎没有公开的代码框架，我仅在此处根据我自己的代码框架给出解法。代码以及参考解法我仍然上传到了我的这一<a target="_blank" rel="noopener" href="https://github.com/ziyuliu258/XJTU-ICS-Implement">仓库</a>中，读者可以自行参考。</p>
<h3 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h3><p>如果你是一名正在选修ICS的XJTU的学生，请你务必首先尝试独立解决课程的所有实验，如果实在觉得想不出来了，再参考本文档的解法；非选课人士也可以参考此文档与代码框架，尝试自己完成这些实验。</p>
<h3 id="本文的侧重点"><a href="#本文的侧重点" class="headerlink" title="本文的侧重点"></a>本文的侧重点</h3><p>我相信有很多同学在这个实验上遇到的困难不在于程序逻辑，而是<strong>工具的使用</strong>。如果你能完美地记住<code>GDB</code>的各种调试语句，那你的阻力会小很多。所以，我将在本文中总结一些<code>GDB</code>的实用技巧，并从具体的各个phase出发，展示如何使用这一调试工具分析、解决问题。</p>
<p>至于基础知识，我也会讲到一些最核心的部分，只不过可能不会非常细致，因为这些知识本应该从书本和课程中掌握，而不是一个实验解析应该负责的部分。</p>
<h3 id="参考实现"><a href="#参考实现" class="headerlink" title="参考实现"></a>参考实现</h3><p>本人的实验代码会同步到这一<a target="_blank" rel="noopener" href="https://github.com/ziyuliu258/XJTU-ICS-Implement">仓库</a>，读者可以自行拉取到本地参考。但是，<strong>请一定要阅读仓库的<code>README</code>文件</strong>，坚持独立完成实验，不要抄袭。独立完成实验对于你的实际能力提升有很大帮助。</p>
<h2 id="实验内容与基本要求"><a href="#实验内容与基本要求" class="headerlink" title="实验内容与基本要求"></a>实验内容与基本要求</h2><h3 id="基本任务"><a href="#基本任务" class="headerlink" title="基本任务"></a>基本任务</h3><p>这个实验给出了一个6阶段的“炸弹”文件<code>bomb</code>的可执行文件，并且给出了基本的代码框架<code>bomb.c</code>。你需要根据可执行文件对应的汇编代码来获知代码的逻辑，获取能够成功拆弹的答案，并填到<code>solution.txt</code>中。</p>
<blockquote>
<p>实验并没有给出原始的汇编代码，<code>gdb</code>会在调试的时候自动调用内置的反汇编库获得该可执行程序的汇编代码，你也可以手动调用GNU的<code>objdump</code>工具来获取汇编代码文件。</p>
</blockquote>
<p>这6个phase实际上就是6个函数，读取你输入的内容作为参数，每个phase的答案都是唯一的。只有你输入了正确的答案，才不会在当前阶段引爆炸弹。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>请你将你的答案分行写在<code>solution.txt</code>文件中，每一行对应一个phase的答案，多个变量中间用空格分隔；输入完最后一个phase的答案后，请再留出<strong>一个空行</strong>，避免<code>EOF</code>标志被误认为被输进程序中的字符。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="代码框架"><a href="#代码框架" class="headerlink" title="代码框架"></a>代码框架</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************************************************************</span></span><br><span class="line"><span class="comment"> * Dr. Evil&#x27;s Insidious Bomb, Version 1.1</span></span><br><span class="line"><span class="comment"> * Copyright 2011, Dr. Evil Incorporated. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * LICENSE:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the</span></span><br><span class="line"><span class="comment"> * VICTIM) explicit permission to use this bomb (the BOMB).  This is a</span></span><br><span class="line"><span class="comment"> * time limited license, which expires on the death of the VICTIM.</span></span><br><span class="line"><span class="comment"> * The PERPETRATOR takes no responsibility for damage, frustration,</span></span><br><span class="line"><span class="comment"> * insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other</span></span><br><span class="line"><span class="comment"> * harm to the VICTIM.  Unless the PERPETRATOR wants to take credit,</span></span><br><span class="line"><span class="comment"> * that is.  The VICTIM may not distribute this bomb source code to</span></span><br><span class="line"><span class="comment"> * any enemies of the PERPETRATOR.  No VICTIM may debug,</span></span><br><span class="line"><span class="comment"> * reverse-engineer, run &quot;strings&quot; on, decompile, decrypt, or use any</span></span><br><span class="line"><span class="comment"> * other technique to gain knowledge of and defuse the BOMB.  BOMB</span></span><br><span class="line"><span class="comment"> * proof clothing may not be worn when handling this program.  The</span></span><br><span class="line"><span class="comment"> * PERPETRATOR will not apologize for the PERPETRATOR&#x27;s poor sense of</span></span><br><span class="line"><span class="comment"> * humor.  This license is null and void where the BOMB is prohibited</span></span><br><span class="line"><span class="comment"> * by law.</span></span><br><span class="line"><span class="comment"> ***************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;support.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;phases.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * Note to self: Remember to erase this file so my victims will have no</span></span><br><span class="line"><span class="comment"> * idea what is going on, and so they will all blow up in a</span></span><br><span class="line"><span class="comment"> * spectaculary fiendish explosion. -- Dr. Evil </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">FILE *infile;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *input;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Note to self: remember to port this bomb to Windows and put a </span></span><br><span class="line"><span class="comment">     * fantastic GUI on it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with no arguments, the bomb reads its input lines </span></span><br><span class="line"><span class="comment">     * from standard input. */</span></span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>) &#123;  </span><br><span class="line">	infile = <span class="built_in">stdin</span>;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with one argument &lt;file&gt;, the bomb reads from &lt;file&gt; </span></span><br><span class="line"><span class="comment">     * until EOF, and then switches to standard input. Thus, as you </span></span><br><span class="line"><span class="comment">     * defuse each phase, you can add its defusing string to &lt;file&gt; and</span></span><br><span class="line"><span class="comment">     * avoid having to retype it. */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (argc == <span class="number">2</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(infile = fopen(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s: Error: Couldn&#x27;t open %s\n&quot;</span>, argv[<span class="number">0</span>], argv[<span class="number">1</span>]);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* You can&#x27;t call the bomb with more than 1 command line argument. */</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Usage: %s [&lt;input_file&gt;]\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Do all sorts of secret stuff that makes the bomb harder to defuse. */</span></span><br><span class="line">    initialize_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my fiendish little bomb. You have 6 phases with\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;which to blow yourself up. Have a nice day!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hmm...  Six phases must be more secure than one phase! */</span></span><br><span class="line">    input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line">    phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br><span class="line">    phase_defused();                 <span class="comment">/* Drat!  They figured it out!</span></span><br><span class="line"><span class="comment">				      * Let me know how they did it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I guess this is too easy so far.  Some more complex code will</span></span><br><span class="line"><span class="comment">     * confuse people. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_3(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_4(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Round and &#x27;round in memory we go, where we stop, the bomb blows! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_5(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This phase will never be used, since no one will get past the</span></span><br><span class="line"><span class="comment">     * earlier ones.  But just in case, make this one extra hard. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_6(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wow, they got it!  But isn&#x27;t something... missing?  Perhaps</span></span><br><span class="line"><span class="comment">     * something they overlooked?  Mua ha ha ha ha! */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>程序的注释很有意思，感兴趣的读者可以读一读，开头的许可证的中文翻译如下：</p>
<blockquote>
<p><strong>邪恶博士的阴险炸弹，版本 1.1</strong></p>
<p><strong>版权所有 2011，邪恶博士有限公司。保留所有权利。</strong></p>
<p><strong>许可证：</strong></p>
<p>邪恶博士有限公司（以下简称 <strong>作恶者</strong>）在此授予您（以下简称 <strong>受害者</strong>）使用此炸弹（以下简称 <strong>本炸弹</strong>）的明确许可。这是一种有限期的许可证，将在 <strong>受害者</strong> 死亡时过期。</p>
<p><strong>作恶者</strong> 对因本程序造成的损害、挫败、精神失常、金鱼眼（bug-eyes）、腕管综合征、失眠或其他对 <strong>受害者</strong> 的伤害概不负责。除非 <strong>作恶者</strong> 想要揽功，那是另一回事。</p>
<p><strong>受害者</strong> 不得将本炸弹的源代码分发给 <strong>作恶者</strong> 的任何敌人。任何 <strong>受害者</strong> 均不得对本程序进行调试、逆向工程、运行 “strings” 命令、反编译、解密，或使用任何其他技术来获取本炸弹的相关知识或拆除本炸弹。</p>
<p>在处理本程序时，不得穿着防爆服。</p>
<p><strong>作恶者</strong> 不会为他那拙劣的幽默感道歉。</p>
<p>在法律禁止本炸弹的地区，本许可证无效。</p>
</blockquote>
<h3 id="生成汇编代码"><a href="#生成汇编代码" class="headerlink" title="生成汇编代码"></a>生成汇编代码</h3><p>这里我们使用<code>objdump -d bomb &gt; bomb.s</code>来生成汇编语言文件。整个汇编代码很长，我们会在下面结合它来分析各个phase的程序逻辑。</p>
<h3 id="phase-1：字符串比较"><a href="#phase-1：字符串比较" class="headerlink" title="phase_1：字符串比较"></a><code>phase_1</code>：字符串比较</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">00000000000015ab &lt;phase_1&gt;:</span><br><span class="line">    15ab:	f3 0f 1e fa          	endbr64</span><br><span class="line">    15af:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">    15b3:	48 8d 35 f2 1a 00 00 	lea    0x1af2(%rip),%rsi        # 30ac &lt;_IO_stdin_used+0xac&gt;</span><br><span class="line">    15ba:	e8 d8 04 00 00       	call   1a97 &lt;strings_not_equal&gt;</span><br><span class="line">    15bf:	85 c0                	test   %eax,%eax # if string not equal returns 0, ZF=1; else ZF=0;</span><br><span class="line">    15c1:	75 05                	jne    15c8 &lt;phase_1+0x1d&gt; # d=13 JUMP IF eax NOT EQUAL 0; ZF=0 then jump --&gt; string equal then jump</span><br><span class="line">    15c3:	48 83 c4 08          	add    $0x8,%rsp # return to original stack state</span><br><span class="line">    15c7:	c3                   	ret</span><br><span class="line">    15c8:	e8 de 05 00 00       	call   1bab &lt;explode_bomb&gt;</span><br><span class="line">    15cd:	eb f4                	jmp    15c3 &lt;phase_1+0x18&gt;</span><br></pre></td></tr></table></figure>

<h4 id="快速解题"><a href="#快速解题" class="headerlink" title="快速解题"></a>快速解题</h4><p>如果要一步一步查看过程中的所有代码，一定会很麻烦。这一题不妨可以跳过<code>strings_not_equal</code>的代码细节，将它当成一个“黑盒子”，这样就简单得多。</p>
<p>由于上面的<code>lea</code>指令把一个地址加载到了第二参数寄存器<code>%rsi</code>中，所以我们不妨假设这个函数总共接收两个参数，首参<code>%rdi</code>是<code>main</code>函数在调用<code>phase_1</code>之前就设置好的，内容就是你的第一行输入。而<code>%ax</code>寄存器</p>
<h4 id="知识补充"><a href="#知识补充" class="headerlink" title="知识补充"></a>知识补充</h4><p>首先，观察一下汇编代码的结构，我们可以发现，<code>sub    $0x8,%rsp</code>和<code>add    $0x8,%rsp</code>这两句是一个函数调用过程中标准的<strong>空间（栈）管理指令</strong>。由于在<code>x86-64</code>架构中，Stack是向低地址增长的，所以<code>sub</code>的作用是申请8字节的临时空间，完成了<strong>创建栈帧</strong>的最后工作；而<code>add</code>就是在函数执行结束前<strong>收回栈帧（“销毁”空间）</strong>， 恢复栈指针原位，维持<strong>栈平衡</strong>。最后接一个<code>ret</code>指令，弹出当前<code>%rsp</code>指向位置的值，将值加载到<code>%rip</code>中（<code>%rsp</code>存储的这个值通常是下一条指令的地址，<code>call</code>指令提前将它压入此处），回到调用前的状态。</p>
<p>其次，我们注意到，<code>lea    0x1af2(%rip),%rsi</code>这句指令将某个固定位置的地址传递给了<code>%rsi</code>，而后者是典型的<code>2nd parameter</code>寄存器。所以我们可以推测，我们传入字符串判断函数的参数应该有两个：一个是输入的字符串，一个是以上通过<code>1ea</code>指令加载的程序本身存储的“答案”字符串。我们要判断输入的字符串是否和程序中存储的字符串相同，从而决定炸弹是否爆炸。</p>
<p>然后，我们要注意这一行指令<code>test   %eax,%eax</code>。<code>test</code>指令会将两个操作数按位相与，然后根据结果设置标志位。而<code>eax</code>&#x2F;<code>rax</code>又是约定俗成的存储<strong>返回值</strong>的寄存器。这就意味着，如果假设<code>strings_not_equal</code>返回一个布尔值&#x2F;int值<code>1/0</code>到<code>%eax</code>中，代表“两字符串不相等”这一判断的真假；1是两个字符串不相同，0是两个字符串相同。那么若 <code>%eax</code> 不为0，<code>ZF</code>将不会被置1，于是<code>%rip</code>就会跳转到<code>15c8</code>，“炸弹”爆炸，拆弹失败。这就印证了我们的猜想：一定要让传入的字符串和程序中存储的字符串相同。</p>
<p><img src="/posts/8eada4ef/image-20260219113023439.png" alt="image-20260219113023439"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://ziyuliu258.github.io">Derrick Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://ziyuliu258.github.io/posts/8eada4ef/">https://ziyuliu258.github.io/posts/8eada4ef/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://ziyuliu258.github.io" target="_blank">日拱一卒</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ICS%E5%AE%9E%E9%AA%8C/">ICS实验</a></div><div class="post-share"><div class="social-share" data-image="/images/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/e26699b7/" title="XJTU-ICS Lab 1: Data Lab"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-14</div><div class="info-item-2">XJTU-ICS Lab 1: Data Lab</div></div><div class="info-2"><div class="info-item-1">前言实验文档与代码框架本文档是参照笔者在sp25所选的西安交通大学计算机系统导论课程与配套实验内容而写成的，参考教材就是大名鼎鼎的CSAPP。至今课程网站仍然可以访问（如果不是校园网连接，可能需要科学上网技术），实验文档、课程PPT、部分代码框架也均可以在上面找到。有兴趣的读者可以自行了解更多内容。 实验1的代码框架是一致的，都可以从这一仓库获取，直接git clone即可。 默认前提本文默认读者已经掌握以下知识&#x2F;技巧：  能够熟练地掌握C语言的基本语法； 有较好的数据结构知识基础； 能够较为熟练地使用Git、make等工具链； 对Linux命令行的基本操作较为熟悉。  但是如果你此时仍然没有掌握以上提到的基本知识，那也没有关系，不会影响完成这个实验。但是为了更好地了解你的电脑，便利你此后的学习之路，你可以尝试学习一下MIT的课程The Missing Semester of Your CS...</div></div></div></a><a class="pagination-related" href="/posts/723210bf/" title="与make命令的初邂逅"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-28</div><div class="info-item-2">与make命令的初邂逅</div></div><div class="info-2"><div class="info-item-1"> 前情提要（偏题）：开学第一周费尽周折选上了学校的ICS（计算机系统导论） 课。此课无比硬核，以著名神书 《CSAPP》...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Derrick Liu</div><div class="author-info-description">An undergraduate majoring in CS.</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ziyuliu258"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ziyuliu258" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1209830516abc@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">昼短苦夜长，何不秉烛游？</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%96%87%E6%A1%A3%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="toc-number">1.1.</span> <span class="toc-text">实验文档与代码框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E7%9A%84%E4%BE%A7%E9%87%8D%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">本文的侧重点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.</span> <span class="toc-text">参考实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9%E4%B8%8E%E5%9F%BA%E6%9C%AC%E8%A6%81%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">实验内容与基本要求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.1.</span> <span class="toc-text">基本任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">题解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="toc-number">3.1.</span> <span class="toc-text">代码框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">生成汇编代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#phase-1%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83"><span class="toc-number">3.3.</span> <span class="toc-text">phase_1：字符串比较</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E8%A7%A3%E9%A2%98"><span class="toc-number">3.3.1.</span> <span class="toc-text">快速解题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-number">3.3.2.</span> <span class="toc-text">知识补充</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8eada4ef/" title="XJTU-ICS Lab 2: Bomb Lab">XJTU-ICS Lab 2: Bomb Lab</a><time datetime="2026-02-18T08:54:45.000Z" title="发表于 2026-02-18 16:54:45">2026-02-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/e26699b7/" title="XJTU-ICS Lab 1: Data Lab">XJTU-ICS Lab 1: Data Lab</a><time datetime="2026-01-14T12:48:52.000Z" title="发表于 2026-01-14 20:48:52">2026-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/723210bf/" title="与make命令的初邂逅">与make命令的初邂逅</a><time datetime="2025-02-27T17:42:17.000Z" title="发表于 2025-02-28 01:42:17">2025-02-28</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8eada4ef/" title="XJTU-ICS Lab 2: Bomb Lab">XJTU-ICS Lab 2: Bomb Lab</a><time datetime="2026-02-18T08:54:45.000Z" title="发表于 2026-02-18 16:54:45">2026-02-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/e26699b7/" title="XJTU-ICS Lab 1: Data Lab">XJTU-ICS Lab 1: Data Lab</a><time datetime="2026-01-14T12:48:52.000Z" title="发表于 2026-01-14 20:48:52">2026-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ffcd24f1/" title="维护日志">维护日志</a><time datetime="2026-01-14T12:24:41.000Z" title="发表于 2026-01-14 20:24:41">2026-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/e4e5df54/" title="在香橙派OrangePi AIPro（8T）上实现基于ACLLite与PyACL的YOLOv10端侧推理">在香橙派OrangePi AIPro（8T）上实现基于ACLLite与PyACL的YOLOv10端侧推理</a><time datetime="2025-08-26T16:00:00.000Z" title="发表于 2025-08-27 00:00:00">2025-08-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6bd52945/" title="网线直连情况下的开发板SSH连接指南">网线直连情况下的开发板SSH连接指南</a><time datetime="2025-08-01T16:00:00.000Z" title="发表于 2025-08-02 00:00:00">2025-08-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/bg2.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2026 By Derrick Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><div class="aplayer no-destroy" data-id="13273018321" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-mini="true" data-theme="#3F51B5"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>